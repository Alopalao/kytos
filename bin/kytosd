#!/usr/bin/env python3.6
"""Start Kytos SDN Platform core."""
import signal

import daemon

from kytos.core.config import KytosConfig
from kytos.core.core import Controller

controller = None
kill_handler = None


def stop_controller(signum, frame):
    """Stop the controller before quitting."""
    if controller:
        print('Stopping controller...')
        # If stop() hangs, old ctrl+c behaviour will be restored
        signal.signal(signal.SIGINT, kill_handler)
        controller.stop()


kill_handler = signal.signal(signal.SIGINT, stop_controller)

if __name__ == '__main__':
    config = KytosConfig()
    controller = Controller(config.options['daemon'])
    if controller.options.foreground:
        controller.start()
    else:
        with daemon.DaemonContext():
            controller.start()
        print('Kytos daemon started.')
